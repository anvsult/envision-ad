@startuml
!theme plain
hide circle
top to bottom direction
!pragma useVerticalIf on
skinparam dpi 350
skinparam packageStyle rectangle
skinparam rectangle {
  BackgroundColor #f7f4eb
  BorderColor Black
}

' === DDD DEFINITIONS ===
!define ENTITY(e) class e <<Entity>>
!define AGGREGATE(a) class a <<Aggregate>>
!define AGGREGATE_ROOT(ar) class ar <<Aggregate Root>>
!define VALUE_OBJECT(vo) class vo <<Value Object>>
!define ENUM(enum) class enum <<Enum>>

title Envision Ad Platform - Domain Driven Design Domain Model

' ===============================
' Media
' ===============================
package "Media Subdomain" #LightGreen {
  AGGREGATE_ROOT(Media) #LightBlue {
    title: String
    estimatedDailyViews: Int
    pricePerHour: Decimal
    width: Decimal
    height: Decimal
    resolution: Decimal
    image: URL
    mediaCorners: double[4]
  }

  note right of Media::height
    Width and height are in CM.
  end note

  ENTITY(MediaType) #LightBlue {
    name: String
    description: String
  }

  VALUE_OBJECT(MediaTypeIdentifier) #Bisque {
    mediaTypeId: UUID
  }

  ENUM(ApprovalStatus) #Orange {
    PENDING
    REJECTED
    APPROVED
  }

  ENUM(ListingStatus) #Orange {
    DRAFT
    LISTED
    UNLISTED
  }

  VALUE_OBJECT(MediaIdentifier) #Bisque {
    mediaId: UUID
  }

  AGGREGATE(MediaLocation) #LightBlue {
    name: String
    description: String
    country: String
    province: String
    city: String
    postalCode: String
    latitude: Float
    longitude: Float
  }

  VALUE_OBJECT(MediaLocationIdentifier) #Bisque {
      mediaLocationId: UUID
}

  MediaType "1" o--> "1" MediaTypeIdentifier
  Media "1" o--> "1" MediaIdentifier
  Media "1" o--> "1" MediaTypeIdentifier
  Media "1" o--> "1" ListingStatus
  Media "1" o--> "1" ApprovalStatus
  MediaLocation "1" o--> "*" "MediaIdentifier"
  MediaLocation "1" o--> "1" "MediaLocationIdentifier"
}

' ===============================
' Advertiser
' ===============================
package "Advertising Subdomain" #LightCoral {
  AGGREGATE_ROOT(AdvertisementCampaign) #LightBlue {
    name: String
    startDate: Date
    endDate: Date
  }

  AGGREGATE(Ad) #LightBlue {
    name: String
    adDurationSeconds: Int
    adUrl: URL
  }

  ENUM(AdType) #Orange {
    IMAGE
    VIDEO
  }

  VALUE_OBJECT(AdIdentifier) #Bisque {
    adId: UUID
  }

  VALUE_OBJECT(AdCampaignIdentifier) #Bisque {
    adCampaignId: UUID
  }

  AdvertisementCampaign "1" o--> "1" AdCampaignIdentifier
  AdvertisementCampaign "1" o--> "1..*" AdIdentifier
  Ad "1" o--> "1" AdIdentifier
  Ad "1" o--> "1" AdType
}

' ===============================
' RESERVATION
' ===============================
package "Reservations Subdomain" #LightPink {
  AGGREGATE_ROOT(Reservation) #LightBlue {
    reservationId: String
    startDate: LocalDateTime
    endDate: LocalDateTime
    totalPrice: Decimal
    advertiserId: String
    campaignId: String
  }

  VALUE_OBJECT(DenialDetails) #Bisque {
    description: String
  }

  ENUM(ReservationStatus) #Orange {
    PENDING
    APPROVED
    DENIED
    CONFIRMED
  }

  ENUM(DenialReason) #Orange {
    CONTENT_POLICY
    CREATIVE_TECHNICAL
    LEGAL_COMPLIANCE
    MEDIA_OWNER_RULES
    LOCAL_VENUE
    OTHER
  }

  VALUE_OBJECT(ReservationIdentifier) #Bisque {
    reservationId: String
  }

  Reservation "1" o--> "1" ReservationIdentifier
  Reservation "1" o--> "1" ReservationStatus
  Reservation "1" o--> "0..1" DenialDetails
  Reservation "1" o--> "1" MediaIdentifier
  Reservation "1" o--> "1" AdCampaignIdentifier

  DenialDetails "1" o--> "1" DenialReason

  note right of Reservation
    **Invariants:**
    1) Status Transition: Approve/deny only when PENDING
    2) Authorization: Only media owner can manage
    3) Denial Reason: Valid reason required, description mandatory for OTHER
    4) Existence: Operations require existing reservation
  end note
}

' ===============================
' Organization
' ===============================
package "Organization Subdomain" #Lavender {
  AGGREGATE_ROOT(Organization) #LightBlue {
    name: String
    employees: int
  }

  AGGREGATE(Employee)  #LightBlue {
    sub (auth0id): String
  }

  VALUE_OBJECT(EmployeeIdentifier) #Bisque {
    employeeId: UUID
  }

  VALUE_OBJECT(OrganizationIdentifier) #Bisque {
    organizationId: UUID
  }

  VALUE_OBJECT(BillingAddress) #Bisque {
    street: String
    city: String
    province: String
    postalCode: String
  }

  Organization "1" o--> "1..*" EmployeeIdentifier
  Employee "1" o--> "1" EmployeeIdentifier

  Organization "1" o--> "1" OrganizationIdentifier
  Organization "1" o--> "1" BillingAddress
}

' ===============================
' REVIEWS
' ===============================

Media "1" o--> "1" OrganizationIdentifier
AdvertisementCampaign "1" o--> "1" OrganizationIdentifier
Reservation "1" o--> "1" OrganizationIdentifier

@enduml
